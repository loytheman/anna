{"version":3,"file":"log.utils.js","sourceRoot":"","sources":["../../src/utils/log.utils.ts"],"names":[],"mappings":"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","sourcesContent":["import type { MarketData, Position, Trade as SSTrade } from \"../interfaces\";\nimport { ibkrPositionTossPosition } from \"../interfaces\";\nimport { getSymbolKey } from \"../utils/instrument.utils\";\nimport { formatDateStr } from \"./time.utils\";\nimport { log, warn } from \"./log\";\nimport type { Contract } from \"@stoqey/ib\";\nimport { Position as IbkrPosition} from \"@stoqey/ib\"\nimport { calculatePnl } from \"../utils/portfolio.utils\";\n\nexport const logBar = (title: string = 'MkdMgr.logBar', bar: MarketData, warning = false): void => {\n    try {\n        const { date, instrument, close, volume } = bar;\n        const symbol = getSymbolKey(instrument);\n        const msg = `${date ? formatDateStr(date) : \"\"} ${symbol ? symbol : \"\"} ${close ? `@${close}` : \"\"} ${volume ? `vol=${volume}` : \"\"}`;\n        if (warning) {\n            return warn(title, msg);\n        };\n        log(title, msg);\n    } catch (error) { }\n}\n\n// type AnyOrder = Order;\nexport const logOrder = (title: string = 'Orders', orderContract: { contract?: Contract, order?: any }, warning = false): void => {\n    try {\n        const date = new Date();\n\n        const order = orderContract.order;\n        const contract = orderContract.contract || order?.instrument;\n        if (!order && !contract) return;\n\n        let msg = formatDateStr(date);\n\n        if (contract) {\n            const symbol = getSymbolKey(contract);\n            msg += `: ${symbol}`;\n        };\n\n        if (order) {\n            msg += `${order.orderId || order.id ? `id=${(`${order.orderId || order.id || \"\"}`).slice(0, 4)}` : \"\"} ${order.action} ${order?.totalQuantity || order.quantity} ${order.auxPrice || order.stopPrice ? `@${order.auxPrice || order.stopPrice}` : \"\"}, ${order.lmtPrice || order.limitPrice ? `LMT=${order.lmtPrice || order.limitPrice}` : \"\"} ${order.orderType || order.type} ${order.tif || \"\"} ${order.outsideRth || order.useRth ? \"RTH\" : \"\"}`;\n        }\n\n        if (warning) {\n            return warn(title, msg);\n        };\n\n        log(title, msg);\n\n    } catch (error) { }\n}\n\nexport const logPosition = (title: string = 'Position', portfolio: IbkrPosition | Position, warning = false): void => {\n    try {\n        const position = (portfolio as IbkrPosition)?.avgCost? ibkrPositionTossPosition(portfolio as IbkrPosition) : portfolio as Position;\n        const date = new Date();\n\n        const contract = position?.instrument;\n        if (!position && !contract) return;\n\n        let msg = formatDateStr(date);\n\n        if (contract) {\n            const symbol = getSymbolKey(contract);\n            msg += `: ${symbol}`;\n        };\n\n        if (position) {\n            const pnl = calculatePnl([position]);\n            msg += `${position.entryDate ? `entry=${formatDateStr(position.entryDate)}` : \"\"} ${position.action} ${position?.quantity} @${position.price} ${position.lastPrice ? `last=${position.lastPrice}` : \"\"} ${pnl ? `pnl=${pnl}` : \"\"}`;\n        }\n\n        if (warning) {\n            return warn(title, msg);\n        };\n\n        log(title, msg);\n\n    } catch (error) { }\n}\n\nexport const logTrade = (title: string = 'Trade', trade: SSTrade, warning = true): void => {\n    try {\n        const date = new Date();\n\n        const contract = trade?.instrument;\n        if (!trade && !contract) return;\n\n        let msg = formatDateStr(date);\n\n        if (contract) {\n            const symbol = getSymbolKey(contract);\n            msg += `: ${symbol}`;\n        };\n\n        if (trade) {\n\n            const position = {\n                price: trade.entryPrice || trade.price,\n                lastPrice: trade.price,\n                quantity: trade.quantity,\n                action: trade.action === \"BUY\" ? \"SELL\" : \"BUY\",\n            } as Position;\n\n            const pnl = calculatePnl([position]);\n            \n            msg += `id=${trade.id ? trade.id.slice(0, 4) : \"\"} ${trade.date ? `date=${formatDateStr(trade.date)}`: \"\"} ${trade.action} ${trade.type} ${trade?.quantity} @${trade.price} ${pnl ? `pnl=${pnl}` : \"\"}`;\n        }\n\n        if (warning) {\n            return warn(title, msg);\n        };\n\n        log(title, msg);\n\n    } catch (error) { }\n}"]}