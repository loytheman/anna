{"version":3,"file":"AccountSummary.js","sourceRoot":"","sources":["../../src/account/AccountSummary.ts"],"names":[],"mappings":";;;;;;AACA,gFAA0D;AAE1D,kCAA+B;AAC/B,IAAM,YAAY,GAAG,+dAA+d,CAAC;AAKpf,CAAC;AA2HF;IAoBI;QAAA,iBACC;QAlBD,mBAAc,GAAoB,EAAgC,CAAC;QAUnE,SAAI,GAAG;YACH,IAAM,EAAE,GAAG,wBAAc,CAAC,QAAQ,CAAC,EAAE,CAAC;YACtC,IAAI,CAAC,KAAI,CAAC,EAAE,EAAE,CAAC;gBACX,KAAI,CAAC,EAAE,GAAG,EAAE,CAAC;YACjB,CAAC;QACL,CAAC,CAAA;QASD,6BAAwB,GAAG,UAAC,KAAqB,EAAE,IAA2B;YAAlD,sBAAA,EAAA,aAAqB;YAAE,qBAAA,EAAA,mBAA2B;YAC1E,KAAI,CAAC,wBAAwB,GAAG,KAAI,CAAC,EAAE,CAAC,iBAAiB,CAAC,KAAK,EAAE,IAAI,CAAC,CAAC,SAAS,CAAC,UAAC,oBAAoB;gBAClG,IAAM,YAAY,GAAG,oBAAoB,CAAC,GAAG,CAAC,MAAM,EAAE,CAAC,IAAI,EAAE,CAAC,KAAK,CAAC;gBACpE,IAAM,SAAS,GAAG,oBAAoB,CAAC,GAAG,CAAC,IAAI,EAAE,CAAC,IAAI,EAAE,CAAC,KAAK,CAAC;gBAC/D,IAAM,cAAc,GAAG,KAAI,CAAC,cAAc,CAAC;gBAC3C,cAAc,CAAC,SAAS,GAAG,SAAS,CAAC;gBACrC,YAAY,CAAC,OAAO,CAAC,UAAC,GAAG,EAAE,OAAO;oBAC9B,GAAG,CAAC,OAAO,CAAC,UAAC,KAAK,EAAE,QAAQ;wBACxB,IAAM,QAAQ,GAAG,KAAK,CAAC,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,KAAK,CAAC;wBAClE,IAAM,WAAW,GAAG,CAAC,QAAQ,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,QAAQ,CAAC;wBAChD,IAAI,CAAC,cAAc,CAAC,OAAO,CAAC,EAAE,CAAC;4BAC3B,cAAc,CAAC,OAAO,CAAC,GAAG,EAA0B,CAAC;wBACzD,CAAC;wBAAA,CAAC;wBACF,IAAI,QAAQ,EAAE,CAAC;4BACX,cAAc,CAAC,OAAO,CAAC,CAAC,KAAK,GAAG,QAAQ,CAAC;wBAC7C,CAAC;wBACD,IAAI,WAAW,EAAE,CAAC;4BACd,cAAc,CAAC,OAAO,CAAC,CAAC,QAAQ,GAAG,WAAW,CAAC;wBACnD,CAAC;oBACL,CAAC,CAAC,CAAC;gBACP,CAAC,CAAC,CAAC;gBACH,IAAA,WAAG,EAAC,0BAAmB,SAAS,CAAE,EAAE,0BAAmB,cAAc,CAAC,cAAc,CAAC,KAAK,cAAI,cAAc,CAAC,cAAc,CAAC,QAAQ,MAAG,CAAC,CAAC;gBACzI,KAAI,CAAC,cAAc,GAAG,cAAc,CAAC;YACzC,CAAC,CAAC,CAAC;QACP,CAAC,CAAA;QAED,8BAAyB,GAAG;YACxB,KAAI,CAAC,wBAAwB,CAAC,WAAW,EAAE,CAAC;QAChD,CAAC,CAAA;IAlCD,CAAC;IAZD,sBAAkB,0BAAQ;aAA1B;YACI,OAAO,IAAI,CAAC,SAAS,IAAI,CAAC,IAAI,CAAC,SAAS,GAAG,IAAI,IAAI,EAAE,CAAC,CAAC;QAC3D,CAAC;;;OAAA;IAYD,sBAAI,6CAAiB;aAArB;YACI,OAAO,IAAI,CAAC,cAAc,CAAC;QAC/B,CAAC;;;OAAA;IAgCL,qBAAC;AAAD,CAAC,AAzDD,IAyDC;AAzDY,wCAAc","sourcesContent":["import { IBApiNext } from \"@stoqey/ib\";\nimport IBKRConnection from \"../connection/IBKRConnection\";\nimport { Subscription } from \"rxjs\";\nimport { log } from \"../utils\";\nconst DEFAULT_TAGS = \"AccountType,NetLiquidation,TotalCashValue,SettledCash,AccruedCash,BuyingPower,EquityWithLoanValue,PreviousDayEquityWithLoanValue,GrossPositionValue,RegTEquity,RegTMargin,SMA,InitMarginReq,MaintMarginReq,AvailableFunds,ExcessLiquidity,Cushion,FullInitMarginReq,FullMaintMarginReq,FullAvailableFunds,FullExcessLiquidity,LookAheadNextChange,LookAheadInitMarginReq,LookAheadMaintMarginReq,LookAheadAvailableFunds,LookAheadExcessLiquidity,HighestSeverity,DayTradesRemaining,Leverage\";\n\ninterface IAccountSummaryValue {\n    value: number | string | null;\n    currency?: string;\n};\n\ninterface IAccountSummary {\n\n    accountId: string;\n    /**\n     * - AccountType — Identifies the IB account structure\n     */\n    AccountType: IAccountSummaryValue;\n    /**\n     * - NetLiquidation — The basis for determining the price of the assets in your account. Total cash value + stock value + options value + bond value\n     */\n    NetLiquidation: IAccountSummaryValue;\n    /**\n     * - TotalCashValue — Total cash balance recognized at the time of trade + futures PNL\n     */\n    TotalCashValue: IAccountSummaryValue;\n    /**\n     * - SettledCash — Cash recognized at the time of settlement - purchases at the time of trade - commissions - taxes - fees\n     */\n    SettledCash: IAccountSummaryValue;\n    /**\n     * - AccruedCash — Total accrued cash value of stock, commodities and securities\n     */\n    AccruedCash: IAccountSummaryValue;\n    /**\n     * - BuyingPower — Buying power serves as a measurement of the dollar value of securities that one may purchase in a securities account without depositing additional funds\n     */\n    BuyingPower: IAccountSummaryValue;\n    /**\n     * - EquityWithLoanValue — Forms the basis for determining whether a client has the necessary assets to either initiate or maintain security positions. Cash + stocks + bonds + mutual funds\n     */\n    EquityWithLoanValue: IAccountSummaryValue;\n    /**\n     * - PreviousDayEquityWithLoanValue — Marginable Equity with Loan value as of 16:00 ET the previous day\n     */\n    PreviousDayEquityWithLoanValue: IAccountSummaryValue;\n    /**\n     * - GrossPositionValue — The sum of the absolute value of all stock and equity option positions\n     */\n    GrossPositionValue: IAccountSummaryValue;\n    /**\n     * - RegTEquity — Regulation T equity for universal account\n     */\n    RegTEquity: IAccountSummaryValue;\n    /**\n     * - RegTMargin — Regulation T margin for universal account\n     */\n    RegTMargin: IAccountSummaryValue;\n    /**\n     * - SMA — Special Memorandum Account: Line of credit created when the market value of securities in a Regulation T account increase in value\n     */\n    SMA: IAccountSummaryValue;\n    /**\n     * - InitMarginReq — Initial Margin requirement of whole portfolio\n     */\n    InitMarginReq: IAccountSummaryValue;\n    /**\n     * - MaintMarginReq — Maintenance Margin requirement of whole portfolio\n     */\n    MaintMarginReq: IAccountSummaryValue;\n    /**\n     * - AvailableFunds — This value tells what you have available for trading\n     */\n    AvailableFunds: IAccountSummaryValue;\n    /**\n     * - ExcessLiquidity — This value shows your margin cushion, before liquidation\n     */\n    ExcessLiquidity: IAccountSummaryValue;\n    /**\n     * - Cushion — Excess liquidity as a percentage of net liquidation value\n     */\n    Cushion: IAccountSummaryValue;\n    /**\n     * - FullInitMarginReq — Initial Margin of whole portfolio with no discounts or intraday credits\n     */\n    FullInitMarginReq: IAccountSummaryValue;\n    /**\n     * - FullMaintMarginReq — Maintenance Margin of whole portfolio with no discounts or intraday credits\n     */\n    FullMaintMarginReq: IAccountSummaryValue;\n    /**\n     * - FullAvailableFunds — Available funds of whole portfolio with no discounts or intraday credits\n     */\n    FullAvailableFunds: IAccountSummaryValue;\n    /**\n     * - FullExcessLiquidity — Excess liquidity of whole portfolio with no discounts or intraday credits\n     */\n    FullExcessLiquidity: IAccountSummaryValue;\n    /**\n     * - LookAheadNextChange — Time when look-ahead values take effect\n     */\n    LookAheadNextChange: IAccountSummaryValue;\n    /**\n     * - LookAheadInitMarginReq — Initial Margin requirement of whole portfolio as of next period's margin change\n     */\n    LookAheadInitMarginReq: IAccountSummaryValue;\n    /**\n     * - LookAheadMaintMarginReq — Maintenance Margin requirement of whole portfolio as of next period's margin change\n     */\n    LookAheadMaintMarginReq: IAccountSummaryValue;\n    /**\n     * - LookAheadAvailableFunds — This value reflects your available funds at the next margin change\n     */\n    LookAheadAvailableFunds: IAccountSummaryValue;\n    /**\n     * - LookAheadExcessLiquidity — This value reflects your excess liquidity at the next margin change\n     */\n    LookAheadExcessLiquidity: IAccountSummaryValue;\n    /**\n     * - HighestSeverity — A measure of how close the account is to liquidation\n     */\n    HighestSeverity: IAccountSummaryValue;\n    /**\n     * - DayTradesRemaining — The Number of Open/Close trades a user could put on before Pattern Day Trading is detected. A value of \"-1\" means that the user can put on unlimited day trades.\n     */\n    DayTradesRemaining: IAccountSummaryValue;\n    /**\n     * - Leverage — GrossPositionValue / NetLiquidation\n     */\n    Leverage: IAccountSummaryValue;\n}\n\nexport class AccountSummary {\n    ib: IBApiNext;\n    \n    accountSummary: IAccountSummary = {} as unknown as IAccountSummary;\n\n    GetAccountSummaryUpdates: Subscription;\n\n    private static _instance: AccountSummary;\n\n    public static get Instance(): AccountSummary {\n        return this._instance || (this._instance = new this());\n    }\n\n    init = () => {\n        const ib = IBKRConnection.Instance.ib;\n        if (!this.ib) {\n            this.ib = ib;\n        }\n    }\n\n    private constructor() {\n    }\n    \n    get getAccountSummary() {\n        return this.accountSummary;\n    }\n\n    getAccountSummaryUpdates = (group: string = \"All\", tags: string = DEFAULT_TAGS) => {\n        this.GetAccountSummaryUpdates = this.ib.getAccountSummary(group, tags).subscribe((accountSummaryUpdate) => {\n            const firstAccount = accountSummaryUpdate.all.values().next().value;\n            const accountId = accountSummaryUpdate.all.keys().next().value;\n            const accountSummary = this.accountSummary;\n            accountSummary.accountId = accountId;\n            firstAccount.forEach((tag, tagName) => {\n                tag.forEach((value, currency) => {\n                    const tagValue = isNaN(+value.value) ? value.value : +value.value;\n                    const tagCurrency = !currency ? null : currency;\n                    if (!accountSummary[tagName]) {\n                        accountSummary[tagName] = {} as IAccountSummaryValue;\n                    };\n                    if (tagValue) {\n                        accountSummary[tagName].value = tagValue;\n                    }\n                    if (tagCurrency) {\n                        accountSummary[tagName].currency = tagCurrency;\n                    }\n                });\n            });\n            log(`AccountSummary: ${accountId}`, `NetLiquidation: ${accountSummary.NetLiquidation.value}(${accountSummary.NetLiquidation.currency})`);\n            this.accountSummary = accountSummary;\n        });\n    }\n\n    unsubscribeAccountSummary = () => {\n        this.GetAccountSummaryUpdates.unsubscribe();\n    }\n    \n}\n"]}